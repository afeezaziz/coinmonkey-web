<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coin Monkey - Edit Credential</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div class="navbar bg-base-100 shadow-lg">
    <div class="navbar-start">
      <a class="btn btn-ghost text-xl" href="/">üêµ Coin Monkey</a>
    </div>
    <div class="navbar-center hidden lg:flex">
      <ul class="menu menu-horizontal px-1">
        <li><a href="/">Home</a></li>
        <li><a href="/about">About</a></li>
        <li><a class="active">Console</a></li>
      </ul>
    </div>
    <div class="navbar-end">
      <a href="/agents/{{ agent.id }}" class="btn btn-ghost">Back to Agent</a>
    </div>
  </div>

  <div class="container mx-auto px-4 py-10">
    <div class="breadcrumbs text-sm mb-6">
      <ul>
        <li><a href="/agents">Agents</a></li>
        <li><a href="/agents/{{ agent.id }}">{{ agent.name }}</a></li>
        <li>Edit Credential</li>
      </ul>
    </div>

    <div class="max-w-2xl mx-auto">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-2xl font-bold">Edit Credential</h1>
        <div class="badge badge-outline">{{ cred.ctype }}</div>
      </div>

      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          {% if cred.ctype == 'cex' %}
          <form action="/agents/{{ agent.id }}/credentials/{{ cred.id }}" method="POST" class="space-y-4">
            <div class="form-control">
              <label class="label"><span class="label-text">Name</span></label>
              <input name="name" type="text" class="input input-bordered" value="{{ cred.name }}" />
            </div>
            <div class="form-control">
              <label class="label"><span class="label-text">Exchange</span></label>
              <input name="exchange" type="text" class="input input-bordered" value="{{ data.get('exchange','') }}" />
            </div>
            <div class="form-control">
              <label class="label"><span class="label-text">API Key</span></label>
              <input name="api_key" type="text" class="input input-bordered" value="{{ data.get('api_key','') }}" />
            </div>
            <div class="form-control">
              <label class="label"><span class="label-text">API Secret</span></label>
              <input name="api_secret" type="password" class="input input-bordered" value="{{ data.get('api_secret','') }}" />
            </div>
            <div class="form-control">
              <label class="label"><span class="label-text">Passphrase (optional)</span></label>
              <input name="passphrase" type="password" class="input input-bordered" value="{{ data.get('passphrase','') }}" />
            </div>
            <div class="flex justify-end gap-2">
              <a href="/agents/{{ agent.id }}" class="btn btn-ghost">Cancel</a>
              <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
          </form>
          {% else %}
          <form action="/agents/{{ agent.id }}/credentials/{{ cred.id }}" method="POST" class="space-y-4">
            <div class="form-control">
              <label class="label"><span class="label-text">Name</span></label>
              <input name="name" type="text" class="input input-bordered" value="{{ cred.name }}" />
            </div>
            <div class="form-control">
              <label class="label"><span class="label-text">RPC URLs (one per line)</span></label>
              <textarea name="urls" class="textarea textarea-bordered h-36">{% for u in (data.get('urls') or []) %}{{ u }}
{% endfor %}</textarea>
            </div>
            <div class="flex justify-end gap-2">
              <a href="/agents/{{ agent.id }}" class="btn btn-ghost">Cancel</a>
              <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
          </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <footer class="footer p-10 bg-base-200 text-base-content">
    <div class="container mx-auto">
      <div class="text-center">
        <p>&copy; 2024 Coin Monkey. All rights reserved.</p>
      </div>
    </div>
  </footer>
  <script>
    (function(){
      try {
        const token = '{{ csrf_token() }}';
        const forms = document.querySelectorAll('form[method="POST"], form[method="post"]');
        for (const f of forms) {
          if (!f.querySelector('input[name="csrf_token"]')) {
            const i = document.createElement('input');
            i.type = 'hidden'; i.name = 'csrf_token'; i.value = token;
            f.appendChild(i);
          }
        }
      } catch (e) { /* ignore */ }
    })();
  </script>
</body>
</html>
